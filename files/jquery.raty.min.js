(function(a){function b(b,d,e){var g=b.attr("id"),h=a("input#"+g+"-score"),l=b.children("img."+g);b.mouseleave(function(){i(b,h.val(),d);c(e,h,d)});l.bind(d.half?"mousemove":"mouseover",function(c){f(g,this.alt,d);if(d.half){var h=parseFloat(((c.pageX-a(this).offset().left)/d.size).toFixed(1));h=h>=0&&h<.5?.5:1;b.data("score",parseFloat(this.alt)+h-1);k(b,b.data("score"),d)}else{f(g,this.alt,d)}j(e,this.alt,d)}).click(function(a){h.val(d.half?b.data("score"):this.alt);if(d.click){d.click.apply(b,[h.val(),a])}})}function c(a,b,c){if(a!==null){var d="";if(c.targetKeep){d=b.val();if(c.targetType=="hint"){if(b.val()==""&&c.cancel){d=c.cancelHint}else{d=c.hintList[Math.ceil(b.val())-1]}}}if(h(a)){a.val(d)}else{a.html(d)}}}function d(b,c,d){var f=undefined;if(c==undefined){e("Specify an ID or class to be the target of the action.");return}if(c){if(c.indexOf(".")>=0){var g;return a(c).each(function(){g="#"+a(this).attr("id");if(d=="start"){a.fn.raty.start(b,g)}else if(d=="click"){a.fn.raty.click(b,g)}else if(d=="readOnly"){a.fn.raty.readOnly(b,g)}})}f=a(c);if(!f.length){e('"'+c+'" is a invalid identifier for the public funtion $.fn.raty.'+d+"().");return}}return f}function e(a){if(window.console&&window.console.log){window.console.log(a)}}function f(b,c,d){var e=a("img."+b).length,f=0,g=0,h,i;for(var j=1;j<=e;j++){h=a("img#"+b+"-"+j);if(j<=c){if(d.iconRange&&d.iconRange.length>f){i=d.iconRange[f][0];g=d.iconRange[f][1];if(j<=g){h.attr("src",d.path+i)}if(j==g){f++}}else{h.attr("src",d.path+d.starOn)}}else{h.attr("src",d.path+d.starOff)}}}function g(a,b,c){if(b!=0){b=parseInt(b);hint=b>0&&c.number<=c.hintList.length&&c.hintList[b-1]!==null?c.hintList[b-1]:b}else{hint=c.noRatedMsg}a.attr("title",hint).children("img").attr("title",hint)}function h(a){return a.is("input")||a.is("select")||a.is("textarea")}function i(b,c,d){var e=b.attr("id");if(isNaN(parseInt(c))){b.children("img."+e).attr("src",d.path+d.starOff);a("input#"+e+"-score").removeAttr("value");return}if(c<0){c=0}else if(c>d.number){c=d.number}f(e,c,d);if(c>0){a("input#"+e+"-score").val(c);if(d.half){k(b,c,d)}}if(d.readOnly||b.css("cursor")=="default"){g(b,c,d)}}function j(a,b,c){if(a!==null){var d=b;if(c.targetType=="hint"){if(b==0&&c.cancel){d=c.cancelHint}else{d=c.hintList[b-1]}}if(h(a)){a.val(d)}else{a.html(d)}}}function k(b,c,d){var e=b.attr("id"),f=Math.ceil(c),g=(f-c).toFixed(1);if(g>.25&&g<=.75){f=f-.5;a("img#"+e+"-"+Math.ceil(f)).attr("src",d.path+d.starHalf)}else if(g>.75){f--}else{a("img#"+e+"-"+f).attr("src",d.path+d.starOn)}}a.fn.raty=function(c){if(this.length==0){e("Selector invalid or missing!");return}else if(this.length>1){return this.each(function(){a.fn.raty.apply(a(this),[c])})}var d=a.extend({},a.fn.raty.defaults,c),h=a(this),i=this.attr("id"),l=0,m=d.starOn,n="",o=d.target,p=d.width?d.width:d.number*d.size+d.number*4;if(i===undefined){i="raty-"+h.index();h.attr("id",i)}if(d.number>20){d.number=20}else if(d.number<0){d.number=0}if(d.path.substring(d.path.length-1,d.path.length)!="/"){d.path+="/"}h.data("options",d);if(!isNaN(parseInt(d.start))&&d.start>0){l=d.start>d.number?d.number:d.start}for(var q=1;q<=d.number;q++){m=l>=q?d.starOn:d.starOff;n=q<=d.hintList.length&&d.hintList[q-1]!==null?d.hintList[q-1]:q;h.append('<img id="'+i+"-"+q+'" src="'+d.path+m+'" alt="'+q+'" title="'+n+'" class="'+i+'"/>').append(q<d.number?" ":"")}if(d.iconRange&&l>0){f(i,l,d)}var r=a("<input/>",{id:i+"-score",type:"hidden",name:d.scoreName}).appendTo(h);if(l>0){r.val(l)}if(d.half){k(h,a("input#"+i+"-score").val(),d)}if(!d.readOnly){if(o!==null){o=a(o);if(o.length==0){e("Target selector invalid or missing!")}}if(d.cancel){var s=a("img."+i),t='<img src="'+d.path+d.cancelOff+'" alt="x" title="'+d.cancelHint+'" class="button-cancel"/>';if(d.cancelPlace=="left"){h.prepend(t+" ")}else{h.append(" ").append(t)}a("#"+i+" img.button-cancel").mouseenter(function(){a(this).attr("src",d.path+d.cancelOn);s.attr("src",d.path+d.starOff);j(o,"",d)}).mouseleave(function(){a(this).attr("src",d.path+d.cancelOff);h.mouseout()}).click(function(b){a("input#"+i+"-score").removeAttr("value");if(d.click){d.click.apply(h,[null,b])}});h.css("width",p+d.size+4)}else{h.css("width",p)}h.css("cursor","pointer");b(h,d,o)}else{h.css("cursor","default");g(h,l,d)}return h};a.fn.raty.cancel=function(b,c){var d=c===undefined?false:true;if(d){a.fn.raty.click("",b,"cancel")}else{a.fn.raty.start("",b,"cancel")}return a.fn.raty};a.fn.raty.click=function(b,c){var f=d(b,c,"click"),g=a(c).data("options");i(f,b,g);if(g.click){g.click.apply(f,[b])}else{e('You must add the "click: function(score, evt) { }" callback.')}return a.fn.raty};a.fn.raty.readOnly=function(c,e){var f=d(c,e,"readOnly"),g=a(e).data("options"),h=f.children("img.button-cancel");if(h[0]){c?h.hide():h.show()}if(c){a("img."+f.attr("id")).unbind();f.css("cursor","default").unbind()}else{b(f,g);f.css("cursor","pointer")}return a.fn.raty};a.fn.raty.start=function(b,c){var e=d(b,c,"start"),f=a(c).data("options");i(e,b,f);return a.fn.raty};a.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:null,half:false,hintList:["Bad","Not so good","Good!","Tasty!","Delicious!"],noRatedMsg:"not rated yet",number:5,path:base_url+"assets/graphics/raty/",iconRange:[],readOnly:false,scoreName:"score",size:16,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",start:0,target:null,targetKeep:false,targetType:"hint",width:null}})(jQuery)