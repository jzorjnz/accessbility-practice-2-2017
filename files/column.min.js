(function(a){a.fn.columnize=function(b){var c={width:400,columns:false,buildOnce:false,overflow:false,doneFunc:function(){},target:false,ignoreImageLoading:true,"float":"left",lastNeverTallest:false};var b=a.extend(c,b);return this.each(function(){function i(c,d,e,f){while(e.height()<f&&d[0].childNodes.length){c.append(d[0].childNodes[0])}if(c[0].childNodes.length==0)return;var g=c[0].childNodes;var h=g[g.length-1];c[0].removeChild(h);var i=a(h);if(i[0].nodeType==3){var j=i[0].nodeValue;var k=b.width/18;if(b.accuracy)k=b.accuracy;var l;var m=null;while(e.height()<f&&j.length){if(j.indexOf(" ",k)!="-1"){l=j.substring(0,j.indexOf(" ",k))}else{l=j}m=document.createTextNode(l);c.append(m);if(j.length>k){j=j.substring(j.indexOf(" ",k))}else{j=""}}if(e.height()>=f&&m!=null){c[0].removeChild(m);j=m.nodeValue+j}if(j.length){i[0].nodeValue=j}else{return false}}if(d.children().length){d.prepend(i)}else{d.append(i)}return i[0].nodeType==3}function j(a,b,c,d){if(b.children().length){$cloneMe=b.children(":first");$clone=$cloneMe.clone(true);if($clone.attr("nodeType")==1&&!$clone.hasClass("dontend")){a.append($clone);if($clone.is("img")&&c.height()<d+20){$cloneMe.remove()}else if(!$cloneMe.hasClass("dontsplit")&&c.height()<d+20){$cloneMe.remove()}else if($clone.is("img")||$cloneMe.hasClass("dontsplit")){$clone.remove()}else{$clone.empty();if(!i($clone,$cloneMe,c,d)){if($cloneMe.children().length){j($clone,$cloneMe,c,d)}}if($clone.get(0).childNodes.length==0){$clone.remove()}}}}}function k(){if(c.data("columnized")&&c.children().length==1){return}c.data("columnized",true);c.data("columnizing",true);c.empty();c.append(a("<div class='first last column' style='width:98%; padding: 3px; float: "+b.float+";'></div>"));$col=c.children().eq(c.children().length-1);$destroyable=e.clone(true);if(b.overflow){targetHeight=b.overflow.height;i($col,$destroyable,$col,targetHeight);if(!$destroyable.children().find(":first-child").hasClass("dontend")){j($col,$destroyable,$col,targetHeight)}while(l($col.children(":last").length&&$col.children(":last").get(0))){var d=$col.children(":last");d.remove();$destroyable.prepend(d)}var f="";var g=document.createElement("DIV");while($destroyable[0].childNodes.length>0){var h=$destroyable[0].childNodes[0];for(var k=0;k<h.attributes.length;k++){if(h.attributes[k].nodeName.indexOf("jQuery")==0){h.removeAttribute(h.attributes[k].nodeName)}}g.innerHTML="";g.appendChild($destroyable[0].childNodes[0]);f+=g.innerHTML}var m=a(b.overflow.id)[0];m.innerHTML=f}else{$col.append($destroyable)}c.data("columnizing",false);if(b.overflow){b.overflow.doneFunc()}}function l(b){if(b.nodeType!=1)return false;if(a(b).hasClass("dontend"))return true;if(b.childNodes.length==0)return false;return l(b.childNodes[b.childNodes.length-1])}function m(){if(f==c.width())return;f=c.width();var g=Math.round(c.width()/b.width);if(b.columns)g=b.columns;if(g<=1){return k()}if(c.data("columnizing"))return;c.data("columnized",true);c.data("columnizing",true);c.empty();c.append(a("<div style='width:"+(Math.round(100/g)-2)+"%; padding: 3px; float: "+b.float+";'></div>"));u=c.children(":last");u.append(e.clone());d=u.height();c.empty();var h=d/g;var m=true;var n=3;var o=false;if(b.overflow){n=1;h=b.overflow.height}else if(b.height&&b.width){n=1;h=b.height;o=true}for(var p=0;p<n;p++){c.empty();var q;try{q=e.clone(true)}catch(r){q=e.clone()}q.css("visibility","hidden");for(var s=0;s<g;s++){var t=s==0?"first column":"column";var t=s==g-1?"last "+t:t;c.append(a("<div class='"+t+"' style='width:"+(Math.round(100/g)-2)+"%; float: "+b.float+";'></div>"))}var s=0;while(s<g-(b.overflow?0:1)||o&&q.children().length){if(c.children().length<=s){c.append(a("<div class='"+t+"' style='width:"+(Math.round(100/g)-2)+"%; float: "+b.float+";'></div>"))}var u=c.children().eq(s);i(u,q,u,h);if(!q.children().find(":first-child").hasClass("dontend")){j(u,q,u,h)}else{}while(l(u.children(":last").length&&u.children(":last").get(0))){var v=u.children(":last");v.remove();q.prepend(v)}s++}if(b.overflow&&!o){var w=false;var x=document.all&&navigator.appVersion.indexOf("MSIE 7.")!=-1;if(w||x){var y="";var z=document.createElement("DIV");while(q[0].childNodes.length>0){var A=q[0].childNodes[0];for(var s=0;s<A.attributes.length;s++){if(A.attributes[s].nodeName.indexOf("jQuery")==0){A.removeAttribute(A.attributes[s].nodeName)}}z.innerHTML="";z.appendChild(q[0].childNodes[0]);y+=z.innerHTML}var B=a(b.overflow.id)[0];B.innerHTML=y}else{a(b.overflow.id).empty().append(q.children().clone(true))}}else if(!o){u=c.children().eq(c.children().length-1);while(q.children().length)u.append(q.children(":first"));var C=u.height();var D=C-h;var E=0;var F=1e7;var G=0;var H=false;c.children().each(function(a){return function(b){var c=a.children().eq(b).height();H=false;E+=c;if(c>G){G=c;H=true}if(c<F)F=c}}(c));var I=E/g;if(b.lastNeverTallest&&H){h=h+30;if(p==n-1)n++}else if(G-F>30){h=I+30}else if(Math.abs(I-h)>20){h=I}else{p=n}}else{c.children().each(function(a){u=c.children().eq(a);u.width(b.width+"px");if(a==0){u.addClass("first")}else if(a==c.children().length-1){u.addClass("last")}else{u.removeClass("first");u.removeClass("last")}});c.width(c.children().length*b.width+"px")}c.append(a("<br style='clear:both;'>"))}c.find(".column").find(":first.removeiffirst").remove();c.find(".column").find(":last.removeiflast").remove();c.data("columnizing",false);if(b.overflow){b.overflow.doneFunc()}b.doneFunc()}var c=b.target?a(b.target):a(this);var d=a(this).height();var e=a("<div></div>");var f=0;var g=false;e.append(a(this).children().clone(true));if(!b.ignoreImageLoading&&!b.target){if(!c.data("imageLoaded")){c.data("imageLoaded",true);if(a(this).find("img").length>0){var h=function(a,c){return function(){if(!a.data("firstImageLoaded")){a.data("firstImageLoaded","true");a.empty().append(c.children().clone(true));a.columnize(b)}}}(a(this),e);a(this).find("img").one("load",h);a(this).find("img").one("abort",h);return}}}c.empty();m();if(!b.buildOnce){a(window).resize(function(){if(!b.buildOnce&&a.browser.msie){if(c.data("timeout")){clearTimeout(c.data("timeout"))}c.data("timeout",setTimeout(m,200))}else if(!b.buildOnce){m()}else{}})}})}})(jQuery)